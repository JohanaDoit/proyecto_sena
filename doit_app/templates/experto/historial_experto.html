{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/calificaciones.css' %}">
{% endblock %}

{% block content %}
<h1>Historial de Servicios Finalizados</h1>
<div class="reservas-lista">
  {% for item in historial %}
    <div class="reserva-card finalizada">
      <div class="reserva-header">
        <div class="reserva-info">
          <span><strong>Cliente:</strong> {{ item.reserva.idUsuario.get_full_name|default:item.reserva.idUsuario.username }}</span>
          <span><strong>Servicio:</strong> {{ item.reserva.idServicios.NombreServicio }}</span>
          <span><strong>Fecha:</strong> {{ item.reserva.Fecha|date:"d/m/Y" }}</span>
        </div>
        <span class="reserva-estado finalizada">Finalizado</span>
      </div>
      <div class="reserva-calificacion">
        <span><strong>Calificación recibida:</strong></span>
        {% if item.calif_cliente %}
          <div class="star-display rating-display" data-rating="{{ item.calif_cliente.puntuacion }}" data-show-number="true"></div>
        {% else %}
          <span>Sin calificar</span>
        {% endif %}
      </div>
      <div class="reserva-comentario">
        <strong>Comentario del cliente:</strong>
        {% if item.calif_cliente and item.calif_cliente.comentario %}
          {{ item.calif_cliente.comentario }}
        {% else %}
          ---
        {% endif %}
      </div>
      <div class="reserva-calificacion">
        <span><strong>Calificación que diste al cliente:</strong></span>
        {% if item.calif_experto %}
          <div class="star-display rating-display" data-rating="{{ item.calif_experto.puntuacion }}" data-show-number="true"></div>
        {% else %}
          <span>Sin calificar</span>
        {% endif %}
      </div>
      <div class="reserva-comentario">
        <strong>Comentario al cliente:</strong>
        {% if item.calif_experto and item.calif_experto.comentario %}
          {{ item.calif_experto.comentario }}
        {% else %}
          ---
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p>No tienes servicios finalizados.</p>
  {% endfor %}
</div>

<script src="{% static 'js/calificaciones.js' %}"></script>
{% endblock %}
